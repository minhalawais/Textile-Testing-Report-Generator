<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image and Data Inputs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <title>Bootstrap Carousel Example</title>
<style>

<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #f5f5f5;
  }
  .container {
    display: flex;
    width: 90%;
    max-width: 1200px;
    justify-content: space-between;
  }
  .rectangle {
    width: 48%; /* Adjust the width as needed */
    height: 680x;
    background-color: #ededed; /* Change to grey color */
    border-radius: 10px;
    margin: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }
  #image-section {
    text-align: center;
  }
  #data-section {
    text-align: left; /* Align input fields to the left */
    display: flex;
    flex-direction: column; /* Place input fields vertically */
    padding: 20px;
  }
  #image-display {
    max-width: 100%;
    max-height: 100%;
    border-radius: 10px;
    object-fit: contain; /* or object-fit: cover; depending on your preference */
  }
  .input-label {
    font-weight: bold;
    margin-bottom: 5px;
  }
  .input-field {
    width: 100%; /* Adjust the width as needed */
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    transition: border-color 0.3s ease-in-out;
  }
  .input-field:focus {
    outline: none;
    border-color: #3498db;
  }

body {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #343f4f;
}
.wrapper {
  display: flex;
  max-width: 650px;
  width: 100%;
  height: 642px;
  background: #fff;
  align-items: center;
  justify-content: center;
  position: relative;
  border-radius: 12px;
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
}
.wrapper i.button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  height: 36px;
  width: 36px;
  background-color: #343f4f;
  border-radius: 50%;
  text-align: center;
  line-height: 36px;
  color: #fff;
  font-size: 15px;
  transition: all 0.3s linear;
  z-index: 100;
  cursor: pointer;
}
i.button:active {
  transform: scale(0.94) translateY(-50%);
}
i#prev {
  left: 25px;
}
i#next {
  right: 25px;
}
.image-container {
    height: 650px;
    max-width: 463px;
    width: 100%;
    overflow: hidden;
}
.image-container .carousel {
  display: flex;
  height: 100%;
  width: 100%;
  transition: all 0.4s ease;
}
.carousel img {
  height: 100%;
  width: 100%;
  border-radius: 18px;
  border: 10px solid #fff;
  object-fit: cover;
}
.carousel {
    display: flex;
    overflow: hidden;
    transition: transform 0.3s ease-in-out;
  }
  .carousel-image {
    width: 100%;
    height: auto;
  }
  .carousel-control-prev{
    margin-left: 0px;
}
  .carousel-control-next{
  margin-right: 0px;
}
.carousel{
  width:100%;
  }

    .w-100 {
    width: 75%!important;
}
.carousel-item {
margin-left:12%;
}
.image-container {
  height: auto; /* Adjust as needed */
  max-width: 100%;
  width: calc(100% - 20px); /* Account for padding and border */
  overflow: hidden;
}
.carousel-indicators {
    right: 162px;
    left: 167px;
}
</style>
</head>
<body>
<div class="container">
    <div class="rectangle" id="image-section"  style="width:60%;     height: 650px;">
      <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="false">
  <ol class="carousel-indicators">
    {% for index in range(images|length) %}
      <li data-target="#carouselExampleIndicators" data-slide-to="{{ index }}" {% if index == 0 %}class="active"{% endif %}></li>
    {% endfor %}
  </ol>
  <div class="carousel-inner">
    {% for index in range(images|length) %}
      <div class="carousel-item {% if index == 0 %}active{% endif %}">
        <img class="d-block w-100" src="{{ images[index] }}" alt="Slide {{ index + 1 }}">
      </div>
    {% endfor %}
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
    </div>
    <div class="rectangle" id="data-section" style="width:40%;">

      <div id="input-fields-container">
        {% for input_data in input_data_list %}
        <div>
          <label class="input-label" for="{{ input_data['id'] }}">{{ input_data['label'] }}:</label>
          <input class="input-field" type="text" list="{{ input_data['datalist_id'] }}" id="{{ input_data['id'] }}">
          <datalist id="{{ input_data['datalist_id'] }}">
            {% for option in input_data['options'] %}
            <option value="{{ option }}"></option>
            {% endfor %}
          </datalist>
        </div>
        {% endfor %}
        <div>
          <label class="input-label" for="new-input-field">Result:</label>
          <input class="input-field" type="text" list="new-input-datalist" id="new-input-field">
          <datalist id="new-input-datalist">
            <option value="pass"></option>
            <option value="fail"></option>
            <option value="see actual result"></option>
          </datalist>
        </div>
      </div>
      <button id="nextTestButton">Next Test</button>
      <a href="/add_labels" class="btn btn-primary" style="margin-top:5% ">ADD Labels</a>
    </div>

</div>
</body>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />

<script>
document.addEventListener("DOMContentLoaded", function() {
  const nextTestButton = document.getElementById("nextTestButton");

  nextTestButton.addEventListener("click", function() {
    sendAndReceiveData();

  });

  // Set the starting image index

    const startingIndex = {{ starting_index }};
    console.log(startingIndex);
    setStartingImage(startingIndex);
});

// ... your existing script ...

function setStartingImage(index) {
  const carouselItems = document.querySelectorAll(".carousel-item");
  const carouselIndicators = document.querySelectorAll(".carousel-indicators li");

  carouselItems.forEach((item, itemIndex) => {
    if (itemIndex === index) {
      item.classList.add("active");
      carouselIndicators[itemIndex].classList.add("active");
    } else {
      item.classList.remove("active");
      carouselIndicators[itemIndex].classList.remove("active");
    }
  });
}

function gatherInputData() {
  const inputData = {};

  // Iterate through all input fields and gather their values
  const inputFields = document.querySelectorAll(".input-field");
  inputFields.forEach(inputField => {
    const inputId = inputField.id;
    const inputValue = inputField.value;
    inputData[inputId] = inputValue;
  });

  return inputData;
}

function sendAndReceiveData() {
  const inputData = gatherInputData();
  // Send the data to Flask using a fetch request
  fetch("/send-receive-data", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(inputData)
  })
  .then(response => response.json())
  .then(data => {
    console.log(data);
    updatePageWithData(data);
    setStartingImage(data['starting_index']);
    console.log(data['starting_index']);
  })
  .catch(error => {
    console.error("Error:", error);
  });
}

function updatePageWithData(data) {
  // Update the slider images
   for (const input_data of data.input_data_list) {
    if (input_data.options.length === 0) {
      window.location.href = "/add_labels";
      return; // Exit the function to prevent further processing
    }
  }
  // Clear existing input fields container
  const inputFieldsContainer = document.getElementById("input-fields-container");
  inputFieldsContainer.innerHTML = '';

  // Create new input fields and populate with options
  data.input_data_list.forEach(input_data => {

    const inputDiv = document.createElement("div");
    inputDiv.innerHTML = `
      <div>
        <label class="input-label" for="${input_data.id}">${input_data.label}:</label>
        <input class="input-field" type="text" list="${input_data.datalist_id}" id="${input_data.id}">
        <datalist id="${input_data.datalist_id}">
          ${input_data.options.map(option => `<option value="${option}"></option>`).join('')}
        </datalist>
      </div>
    `;
    inputFieldsContainer.appendChild(inputDiv);

    // Set the input field value to the first option
    const inputField = inputDiv.querySelector(".input-field");
    if (inputField && input_data.options.length > 0) {
      inputField.value = input_data.options[0];
      inputField.setAttribute("list", input_data.datalist_id); // Set the datalist for autocomplete
    }
  });

  // Add the "Result" input field
  const resultInput = document.createElement("div");
  resultInput.innerHTML = `
    <div>
      <label class="input-label" for="new-input-field">Result:</label>
      <input class="input-field" type="text" list="new-input-datalist" id="new-input-field">
      <datalist id="new-input-datalist">
        <option value="pass"></option>
        <option value="fail"></option>
        <option value="see actual result"></option>
      </datalist>
    </div>
  `;
  inputFieldsContainer.appendChild(resultInput);

  // Set the value of the "Result" input field to the first option
  const resultInputField = resultInput.querySelector(".input-field");
  if (resultInputField) {
    const firstResultOption = resultInput.querySelector("#new-input-datalist option");
    if (firstResultOption) {
      resultInputField.value = firstResultOption.value;
    }
  }
}


</script>
</html>
